{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport firebase from 'firebase/compat/app';\nimport 'firebase/compat/firestore';\nimport 'firebase/compat/storage';\nimport { NavigationContainer } from '@react-navigation/native';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function Save(props) {\n  var _useState = useState(\"\"),\n    _useState2 = _slicedToArray(_useState, 2),\n    caption = _useState2[0],\n    setCaption = _useState2[1];\n  var uploadImage = function () {\n    var _ref = _asyncToGenerator(function* () {\n      var uri = props.route.params.image;\n      var response = yield fetch(uri);\n      var blob = yield response.blob();\n      var childPath = \"post/\" + firebase.auth().currentUser.uid + \"/\" + Math.random().toString(36);\n      var task = firebase.storage().ref().child(childPath).put(blob);\n      var taskProgress = function taskProgress(snapshot) {\n        console.log(\"Transferred: \" + snapshot.byteTransferred);\n      };\n      var taskCompleted = function taskCompleted() {\n        task.snapshot.ref.getDownloadURL().then(function (snapshot) {\n          savePostData(snapshot);\n          console.log(snapshot);\n        });\n      };\n      var taskError = function taskError(snapshot) {\n        console.log(snapshot);\n      };\n      task.on(\"state_changed\", taskProgress, taskError, taskCompleted);\n    });\n    return function uploadImage() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var savePostData = function savePostData(downloadURL) {\n    firebase.firestore().collection('posts').doc(firebase.auth().currentUser.uid).collection('userPosts').add({\n      downloadURL: downloadURL,\n      caption: caption,\n      creation: firebase.firestore.FieldValue.serverTimestamp()\n    }).then(function () {\n      props.navigation.popToTop();\n    });\n  };\n  return _jsxs(View, {\n    style: {\n      flex: 1\n    },\n    children: [_jsx(Image, {\n      source: {\n        uri: props.route.params.image\n      }\n    }), _jsx(TextInput, {\n      placeholder: \"Write your caption...\",\n      onChangeText: function onChangeText(caption) {\n        return setCaption(caption);\n      }\n    }), _jsx(Button, {\n      title: \"Upload\",\n      onPress: function onPress() {\n        return uploadImage();\n      }\n    })]\n  });\n}","map":{"version":3,"names":["React","useState","View","TextInput","Image","Button","firebase","NavigationContainer","jsx","_jsx","jsxs","_jsxs","Save","props","_useState","_useState2","_slicedToArray","caption","setCaption","uploadImage","_ref","_asyncToGenerator","uri","route","params","image","response","fetch","blob","childPath","auth","currentUser","uid","Math","random","toString","task","storage","ref","child","put","taskProgress","snapshot","console","log","byteTransferred","taskCompleted","getDownloadURL","then","savePostData","taskError","on","apply","arguments","downloadURL","firestore","collection","doc","add","creation","FieldValue","serverTimestamp","navigation","popToTop","style","flex","children","source","placeholder","onChangeText","title","onPress"],"sources":["D:/software_studio/final project/beprod/BeProductive/components/main/Save.js"],"sourcesContent":["import React, {useState} from 'react'\r\nimport {View, TextInput, Image,Button} from 'react-native'\r\nimport firebase from 'firebase/compat/app'\r\nimport 'firebase/compat/firestore'\r\nimport 'firebase/compat/storage'\r\nimport { NavigationContainer } from '@react-navigation/native'\r\n\r\n\r\n\r\nexport default function Save(props) {\r\n    const [caption, setCaption] = useState(\"\")\r\n\r\n    const uploadImage= async ()=> {\r\n        const uri = props.route.params.image;\r\n        const response = await fetch(uri);\r\n        const blob = await response.blob();\r\n        const childPath = `post/${firebase.auth().currentUser.uid}/${Math.random().toString(36)}`;\r\n        const task = firebase\r\n        .storage()\r\n        .ref()\r\n        .child(childPath)\r\n        .put(blob);\r\n        \r\n        const taskProgress = snapshot => {\r\n            console.log(`Transferred: ${snapshot.byteTransferred}`)\r\n        }\r\n\r\n        const taskCompleted = () => {\r\n            task.snapshot.ref.getDownloadURL().then((snapshot) => {\r\n                savePostData(snapshot);\r\n                console.log(snapshot)\r\n            })\r\n        }\r\n\r\n        const taskError = snapshot => {\r\n            console.log(snapshot)\r\n        }\r\n\r\n        task.on(\"state_changed\",taskProgress,  taskError, taskCompleted);\r\n    }\r\n\r\n    const savePostData = (downloadURL) => {\r\n        firebase.firestore()\r\n        .collection('posts')\r\n        .doc(firebase.auth().currentUser.uid)\r\n        .collection('userPosts')\r\n        .add({\r\n            downloadURL,\r\n            caption,\r\n            creation: firebase.firestore.FieldValue.serverTimestamp()\r\n        }).then((function () {\r\n            props.navigation.popToTop()\r\n        })) \r\n    }\r\n\r\n    return (\r\n        <View style={{flex:1}}>\r\n            <Image source = {{uri: props.route.params.image}}/>\r\n            <TextInput\r\n                placeholder='Write your caption...'\r\n                onChangeText={(caption)=> setCaption(caption)}\r\n            />\r\n            <Button title = \"Upload\" onPress={()=>uploadImage()}/>\r\n        </View>\r\n    )\r\n}\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAGC,QAAQ,QAAO,OAAO;AAAA,OAAAC,IAAA;AAAA,OAAAC,SAAA;AAAA,OAAAC,KAAA;AAAA,OAAAC,MAAA;AAErC,OAAOC,QAAQ,MAAM,qBAAqB;AAC1C,OAAO,2BAA2B;AAClC,OAAO,yBAAyB;AAChC,SAASC,mBAAmB,QAAQ,0BAA0B;AAAA,SAAAC,GAAA,IAAAC,IAAA;AAAA,SAAAC,IAAA,IAAAC,KAAA;AAI9D,eAAe,SAASC,IAAIA,CAACC,KAAK,EAAE;EAChC,IAAAC,SAAA,GAA8Bb,QAAQ,CAAC,EAAE,CAAC;IAAAc,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAAnCG,OAAO,GAAAF,UAAA;IAAEG,UAAU,GAAAH,UAAA;EAE1B,IAAMI,WAAW;IAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAE,aAAW;MAC1B,IAAMC,GAAG,GAAGT,KAAK,CAACU,KAAK,CAACC,MAAM,CAACC,KAAK;MACpC,IAAMC,QAAQ,SAASC,KAAK,CAACL,GAAG,CAAC;MACjC,IAAMM,IAAI,SAASF,QAAQ,CAACE,IAAI,CAAC,CAAC;MAClC,IAAMC,SAAS,aAAWvB,QAAQ,CAACwB,IAAI,CAAC,CAAC,CAACC,WAAW,CAACC,GAAG,SAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAG;MACzF,IAAMC,IAAI,GAAG9B,QAAQ,CACpB+B,OAAO,CAAC,CAAC,CACTC,GAAG,CAAC,CAAC,CACLC,KAAK,CAACV,SAAS,CAAC,CAChBW,GAAG,CAACZ,IAAI,CAAC;MAEV,IAAMa,YAAY,GAAG,SAAfA,YAAYA,CAAGC,QAAQ,EAAI;QAC7BC,OAAO,CAACC,GAAG,mBAAiBF,QAAQ,CAACG,eAAiB,CAAC;MAC3D,CAAC;MAED,IAAMC,aAAa,GAAG,SAAhBA,aAAaA,CAAA,EAAS;QACxBV,IAAI,CAACM,QAAQ,CAACJ,GAAG,CAACS,cAAc,CAAC,CAAC,CAACC,IAAI,CAAC,UAACN,QAAQ,EAAK;UAClDO,YAAY,CAACP,QAAQ,CAAC;UACtBC,OAAO,CAACC,GAAG,CAACF,QAAQ,CAAC;QACzB,CAAC,CAAC;MACN,CAAC;MAED,IAAMQ,SAAS,GAAG,SAAZA,SAASA,CAAGR,QAAQ,EAAI;QAC1BC,OAAO,CAACC,GAAG,CAACF,QAAQ,CAAC;MACzB,CAAC;MAEDN,IAAI,CAACe,EAAE,CAAC,eAAe,EAACV,YAAY,EAAGS,SAAS,EAAEJ,aAAa,CAAC;IACpE,CAAC;IAAA,gBA3BK3B,WAAWA,CAAA;MAAA,OAAAC,IAAA,CAAAgC,KAAA,OAAAC,SAAA;IAAA;EAAA,GA2BhB;EAED,IAAMJ,YAAY,GAAG,SAAfA,YAAYA,CAAIK,WAAW,EAAK;IAClChD,QAAQ,CAACiD,SAAS,CAAC,CAAC,CACnBC,UAAU,CAAC,OAAO,CAAC,CACnBC,GAAG,CAACnD,QAAQ,CAACwB,IAAI,CAAC,CAAC,CAACC,WAAW,CAACC,GAAG,CAAC,CACpCwB,UAAU,CAAC,WAAW,CAAC,CACvBE,GAAG,CAAC;MACDJ,WAAW,EAAXA,WAAW;MACXrC,OAAO,EAAPA,OAAO;MACP0C,QAAQ,EAAErD,QAAQ,CAACiD,SAAS,CAACK,UAAU,CAACC,eAAe,CAAC;IAC5D,CAAC,CAAC,CAACb,IAAI,CAAE,YAAY;MACjBnC,KAAK,CAACiD,UAAU,CAACC,QAAQ,CAAC,CAAC;IAC/B,CAAE,CAAC;EACP,CAAC;EAED,OACIpD,KAAA,CAACT,IAAI;IAAC8D,KAAK,EAAE;MAACC,IAAI,EAAC;IAAC,CAAE;IAAAC,QAAA,GAClBzD,IAAA,CAACL,KAAK;MAAC+D,MAAM,EAAI;QAAC7C,GAAG,EAAET,KAAK,CAACU,KAAK,CAACC,MAAM,CAACC;MAAK;IAAE,CAAC,CAAC,EACnDhB,IAAA,CAACN,SAAS;MACNiE,WAAW,EAAC,uBAAuB;MACnCC,YAAY,EAAE,SAAAA,aAACpD,OAAO;QAAA,OAAIC,UAAU,CAACD,OAAO,CAAC;MAAA;IAAC,CACjD,CAAC,EACFR,IAAA,CAACJ,MAAM;MAACiE,KAAK,EAAG,QAAQ;MAACC,OAAO,EAAE,SAAAA,QAAA;QAAA,OAAIpD,WAAW,CAAC,CAAC;MAAA;IAAC,CAAC,CAAC;EAAA,CACpD,CAAC;AAEf"},"metadata":{},"sourceType":"module","externalDependencies":[]}